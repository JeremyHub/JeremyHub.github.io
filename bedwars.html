<html>
<head>
<title>Bed Wars Timer</title>

<style>
body {
    text-align:center;
    color: #fff;
    background-color: black;
}
body, .btn {
    font-size: 46px;
}
.d { color: #33ebcb;}
.e { color: #50c878;}
.num { font-weight: bold;}
</style>

<script>
    var diamondtimes = [34];
    while (diamondtimes[diamondtimes.length-1]<6*60) {
        diamondtimes.push(diamondtimes[diamondtimes.length-1]+32.5);
    }
    while (diamondtimes[diamondtimes.length-1]<18*60) {
        diamondtimes.push(diamondtimes[diamondtimes.length-1]+23.5);
    }

    var emeraldtimes = [55];
    while (emeraldtimes[emeraldtimes.length-1]<12*60) {
        emeraldtimes.push(emeraldtimes[emeraldtimes.length-1]+58.5)
    }

    function setTimer(delta) {
        if (delta <= 6*60) {
            newdelta = 6*60-delta;
            until = "Diamond II";
        } else if (delta <= 12*60) {
            newdelta = 12*60-delta;
            until = "Emerald II";
        } else if (delta <= 18*60) {
            newdelta = 18*60-delta;
            until = "Diamond III";
        } else if (delta <= 24*60) {
            newdelta = 24*60-delta;
            until = "Emerald III";
        }

        mins = Math.floor(newdelta/60);
        secs = Math.floor(newdelta % 60);
        secs = secs.toLocaleString('en-US',{minimumIntegerDigits:2});
        document.getElementById("timer").innerHTML = mins+":"+secs;
        document.getElementById("until").innerHTML = until;
    }

    function setCheckTimer(delta) {
        time = Math.floor(delta-lastchecked);

        mins = Math.floor(time/60);
        secs = time % 60;
        secs = secs.toLocaleString('en-US',{minimumIntegerDigits:2});
        document.getElementById("lastcheck").innerHTML = mins+":"+secs;
    }

    function setGems(delta, times, gemname) {
        sofar = times.filter(x => x<=delta).length;
        nextgem = times[sofar]
        sincecheck = times.filter(x => x<=lastchecked).length

        document.getElementById(gemname+"ssofar").innerHTML = sofar;   
        document.getElementById("timeto"+gemname).innerHTML = Math.floor(nextgem-delta);
        document.getElementById("recent"+gemname+"s").innerHTML = sofar-sincecheck;
    }

    function start() {
        starttime = Date.now();
        lastchecked = 0
    }

    var starttime = 0;
    var lastchecked = 0;
    window.onkeydown = function(event) {
        keyCode = event.keyCode
        console.log(keyCode)
        if (keyCode == 32) start()
        else if (keyCode == 27 || keyCode == 8) starttime = 0;
        else if (keyCode == 39) {
            if (starttime) starttime -= 1000;
        }
        else if ((keyCode <= 95 && keyCode >= 60) || keyCode==16) {
            lastchecked = (Date.now()-starttime)/1000
        }
    }

    setInterval(function() {
        if(starttime == 0) return;

        var delta = (Date.now() - starttime)/1000;

        setTimer(delta);
        setCheckTimer(delta);
        setGems(delta, diamondtimes, "diamond");
        setGems(delta, emeraldtimes, "emerald");

    }, 10)



</script>
</head>

<body>

<div id="timer-block">
    <div id="timer-main">
    <span id=timer>6:00</span> Until <span id=until>Diamond II</span>
    </div>
    <div id="timer-lastcheck">
    <span id=lastcheck>0:00</span> Since Last Check
    </div>
</div>

<br>

<div id="diamond">
    <div id="diamond-next">
    Next <span class=d>Diamond</span> in <span class=num id=timetodiamond>34</span> Seconds
    </div>
    <div id="diamond-total">
    Total of <span class=num id=diamondssofar>0</span> <span class=d>Diamonds</span> So Far 
    </div>
    <div id="diamond-recent">
    <span class=num id=recentdiamonds>0</span> <span class=d>Diamonds</span> Since Last Checked
    </div>
</div>

<br>

<div id="emerald">
    <div id="emerald-next">
    Next <span class=e>Emerald</span> in <span class=num id=timetoemerald>55</span> Seconds
    </div>
    <div id="emerald-total">
    Total of <span class=num id=emeraldssofar>0</span> <span class=e>Emeralds</span> So Far 
    </div>
    <div id="emerald-recent">
    <span class=num id=recentemeralds>0</span> <span class=e>Emeralds</span> Since Last Checked
    </div>
</div>

<br>

<div>
<button class="btn" onclick=start()>Start</button>
</div>

</body>
</html>